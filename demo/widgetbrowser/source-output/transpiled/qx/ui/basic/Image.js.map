{
  "version": 3,
  "sources": [
    "Image.js"
  ],
  "names": [
    "qx",
    "Bootstrap",
    "executePendingDefers",
    "$$dbClassInfo",
    "Class",
    "define",
    "extend",
    "ui",
    "core",
    "Widget",
    "construct",
    "source",
    "__contentElements",
    "setSource",
    "properties",
    "check",
    "init",
    "nullable",
    "event",
    "apply",
    "themeable",
    "scale",
    "appearance",
    "refine",
    "allowShrinkX",
    "allowShrinkY",
    "allowGrowX",
    "allowGrowY",
    "events",
    "loadingFailed",
    "loaded",
    "aborted",
    "statics",
    "PLACEHOLDER_IMAGE",
    "members",
    "__width",
    "__height",
    "__mode",
    "__currentContentElement",
    "__wrapper",
    "__requestId",
    "_onChangeTheme",
    "_styleSource",
    "getContentElement",
    "__getSuitableContentElement",
    "_createContentElement",
    "_getContentHint",
    "width",
    "height",
    "_applyDecorator",
    "value",
    "old",
    "getSource",
    "util",
    "AliasManager",
    "getInstance",
    "resolve",
    "el",
    "getChild",
    "__setSource",
    "_applyTextColor",
    "__getMode",
    "setStyle",
    "theme",
    "manager",
    "Color",
    "removeStyle",
    "_applyPadding",
    "name",
    "element",
    "setStyles",
    "top",
    "getPaddingTop",
    "left",
    "getPaddingLeft",
    "setPadding",
    "renderLayout",
    "getPaddingRight",
    "getPaddingBottom",
    "_applyEnabled",
    "_applySource",
    "io",
    "ImageLoader",
    "isLoading",
    "abort",
    "_applyScale",
    "__setMode",
    "mode",
    "lang",
    "String",
    "startsWith",
    "isPng",
    "endsWith",
    "getScale",
    "Environment",
    "get",
    "__createSuitableContentElement",
    "tagName",
    "clazz",
    "html",
    "Image",
    "Label",
    "connectWidget",
    "setRich",
    "setScale",
    "wrapper",
    "Element",
    "add",
    "$$disposed",
    "ResourceManager",
    "__resetSource",
    "__checkForContentElementSwitch",
    "parseInt",
    "repeat",
    "tagNameHint",
    "bom",
    "Decoration",
    "getTagName",
    "contentEl",
    "__getContentElement",
    "isFontUri",
    "__setManagedImage",
    "has",
    "highResolutionSource",
    "_findHighResolutionSource",
    "imageWidth",
    "getImageHeight",
    "imageHeight",
    "getImageWidth",
    "setWidth",
    "setHeight",
    "backgroundSize",
    "__fireLoadEvent",
    "isLoaded",
    "__setUnmanagedImage",
    "__loadUnmanagedImage",
    "AnimationFrame",
    "request",
    "rId",
    "fireEvent",
    "bind",
    "select",
    "alphaImageLoader",
    "isFont",
    "__checkForContentElementReplacement",
    "elementToAdd",
    "currentContentElement",
    "pixel",
    "styles",
    "currentStyles",
    "getAllStyles",
    "prop",
    "bounds",
    "getBounds",
    "insets",
    "getInsets",
    "getStyle",
    "zIndex",
    "newEl",
    "setSelectable",
    "getSelectable",
    "isVisible",
    "hide",
    "show",
    "isIncluded",
    "exclude",
    "include",
    "container",
    "getParent",
    "index",
    "getChildren",
    "indexOf",
    "removeAt",
    "addAt",
    "hint",
    "getNodeName",
    "setValue",
    "currentEl",
    "setAttribute",
    "getAttribute",
    "flush",
    "currentDomEl",
    "getDomElement",
    "newDomEl",
    "listeners",
    "getListeners",
    "forEach",
    "listenerData",
    "addListener",
    "type",
    "handler",
    "self",
    "capture",
    "currentHash",
    "$$hash",
    "getEnabled",
    "disabled",
    "replace",
    "addState",
    "removeState",
    "size",
    "split",
    "getWidth",
    "getHeight",
    "font",
    "Font",
    "match",
    "assertObject",
    "getSize",
    "__updateContentHint",
    "_applyDimension",
    "sourceLC",
    "toLowerCase",
    "__warned",
    "debug",
    "isFailed",
    "load",
    "__loaderCallback",
    "resetSource",
    "resetValue",
    "sparts",
    "fontSource",
    "length",
    "fontStyles",
    "Object",
    "clone",
    "getStyles",
    "color",
    "resource",
    "getData",
    "fromCharCode",
    "charCode",
    "assertNumber",
    "decorator",
    "getDecorator",
    "hasGradient",
    "getStartColor",
    "getEndColor",
    "hasBackground",
    "getBackgroundImage",
    "attr",
    "getAttributes",
    "decoratorStyle",
    "combinedStyles",
    "style",
    "backgroundImage",
    "backgroundPosition",
    "backgroundRepeat",
    "getBackgroundRepeat",
    "lowResImgSrc",
    "pixelRatioCandidates",
    "factor",
    "parseFloat",
    "client",
    "Device",
    "getDevicePixelRatio",
    "toFixed",
    "i",
    "hiResImgSrc",
    "k",
    "_getHighResolutionSource",
    "pixelRatio",
    "fileExtIndex",
    "lastIndexOf",
    "pixelRatioIdentifier",
    "candidate",
    "slice",
    "imageInfo",
    "failed",
    "warn",
    "queue",
    "Layout",
    "destruct",
    "hasOwnProperty",
    "disconnectWidget",
    "_disposeMap",
    "basic"
  ],
  "mappings": "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",
  "file": "Image.js",
  "sourcesContent": [
    "/* ************************************************************************\n\n   qooxdoo - the new era of web development\n\n   http://qooxdoo.org\n\n   Copyright:\n     2004-2008 1&1 Internet AG, Germany, http://www.1und1.de\n\n   License:\n     MIT: https://opensource.org/licenses/MIT\n     See the LICENSE file in the project's top-level directory for details.\n\n   Authors:\n     * Fabian Jakobs (fjakobs)\n     * Sebastian Werner (wpbasti)\n\n************************************************************************ */\n\n/**\n * The image class displays an image file\n *\n * This class supports image clipping, which means that multiple images can be combined\n * into one large image and only the relevant part is shown.\n *\n * *Example*\n *\n * Here is a little example of how to use the widget.\n *\n * <pre class='javascript'>\n *   var image = new qx.ui.basic.Image(\"icon/32/actions/format-justify-left.png\");\n *\n *   this.getRoot().add(image);\n * </pre>\n *\n * This example create a widget to display the image\n * <code>icon/32/actions/format-justify-left.png</code>.\n *\n * *External Documentation*\n *\n * <a href='http://manual.qooxdoo.org/${qxversion}/pages/widget/image.html' target='_blank'>\n * Documentation of this widget in the qooxdoo manual.</a>\n * \n * NOTE: Instances of this class must be disposed of after use\n *\n */\nqx.Class.define(\"qx.ui.basic.Image\",\n{\n  extend : qx.ui.core.Widget,\n\n\n\n  /*\n  *****************************************************************************\n     CONSTRUCTOR\n  *****************************************************************************\n  */\n\n  /**\n   * @param source {String?null} The URL of the image to display.\n   */\n  construct : function(source)\n  {\n    this.__contentElements = {};\n\n    this.base(arguments);\n\n    if (source) {\n      this.setSource(source);\n    }\n  },\n\n\n\n\n  /*\n  *****************************************************************************\n     PROPERTIES\n  *****************************************************************************\n  */\n\n  properties :\n  {\n    /** The URL of the image. Setting it will possibly abort loading of current image. */\n    source :\n    {\n      check : \"String\",\n      init : null,\n      nullable : true,\n      event : \"changeSource\",\n      apply : \"_applySource\",\n      themeable : true\n    },\n\n\n    /**\n     * Whether the image should be scaled to the given dimensions\n     *\n     * This is disabled by default because it prevents the usage\n     * of image clipping when enabled.\n     */\n    scale :\n    {\n      check : \"Boolean\",\n      init : false,\n      event : \"changeScale\",\n      themeable : true,\n      apply : \"_applyScale\"\n    },\n\n\n    // overridden\n    appearance :\n    {\n      refine : true,\n      init : \"image\"\n    },\n\n\n    // overridden\n    allowShrinkX :\n    {\n      refine : true,\n      init : false\n    },\n\n\n    // overridden\n    allowShrinkY :\n    {\n      refine : true,\n      init : false\n    },\n\n\n    // overridden\n    allowGrowX :\n    {\n      refine : true,\n      init : false\n    },\n\n\n    // overridden\n    allowGrowY :\n    {\n      refine : true,\n      init : false\n    }\n  },\n\n\n  /*\n  *****************************************************************************\n     EVENTS\n  *****************************************************************************\n  */\n\n  events :\n  {\n    /**\n     * Fired if the image source can not be loaded. This event can only be\n     * fired for the first loading of an unmanaged resource (external image).\n     */\n    loadingFailed : \"qx.event.type.Event\",\n\n\n    /**\n     * Fired if the image has been loaded. This is even true for managed\n     * resources (images known by generator).\n     */\n    loaded : \"qx.event.type.Event\",\n\n\n    /** Fired when the pending request has been aborted. */\n    aborted : \"qx.event.type.Event\"\n  },\n\n\n  statics:\n  {\n    PLACEHOLDER_IMAGE: \"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\"\n  },\n\n  /*\n  *****************************************************************************\n     MEMBERS\n  *****************************************************************************\n  */\n\n  members :\n  {\n    __width : null,\n    __height : null,\n    __mode : null,\n    __contentElements : null,\n    __currentContentElement : null,\n    __wrapper : null,\n    __requestId : 0,\n\n\n    //overridden\n    _onChangeTheme : function() {\n      this.base(arguments);\n      // restyle source (theme change might have changed the resolved url)\n      this._styleSource();\n    },\n\n    /*\n    ---------------------------------------------------------------------------\n      WIDGET API\n    ---------------------------------------------------------------------------\n    */\n\n    // overridden\n    getContentElement : function() {\n      return this.__getSuitableContentElement();\n    },\n\n\n    // overridden\n    _createContentElement : function() {\n      return this.__getSuitableContentElement();\n    },\n\n\n    // overridden\n    _getContentHint : function()\n    {\n      return {\n        width : this.__width || 0,\n        height : this.__height || 0\n      };\n    },\n\n    // overridden\n    _applyDecorator : function(value, old) {\n      this.base(arguments, value, old);\n\n      var source = this.getSource();\n      source = qx.util.AliasManager.getInstance().resolve(source);\n      var el = this.getContentElement();\n      if (this.__wrapper) {\n        el = el.getChild(0);\n      }\n      this.__setSource(el, source);\n    },\n\n    // overridden\n    _applyTextColor : function(value)\n    {\n      if (this.__getMode() === \"font\") {\n        var el = this.getContentElement();\n        if (this.__wrapper) {\n          el = el.getChild(0);\n        }\n\n        if (value) {\n          el.setStyle(\"color\", qx.theme.manager.Color.getInstance().resolve(value));\n        } else {\n          el.removeStyle(\"color\");\n        }\n      }\n    },\n\n    // overridden\n    _applyPadding : function(value, old, name)\n    {\n      this.base(arguments, value, old, name);\n\n      var element = this.getContentElement();\n      if (this.__wrapper) {\n        element.getChild(0).setStyles({\n          top: this.getPaddingTop() || 0,\n          left: this.getPaddingLeft() || 0\n        });\n      } else {\n        element.setPadding(\n          this.getPaddingLeft() || 0, this.getPaddingTop() || 0\n        );\n      }\n\n    },\n\n    renderLayout : function(left, top, width, height) {\n      this.base(arguments, left, top, width, height);\n\n      var element = this.getContentElement();\n      if (this.__wrapper) {\n        element.getChild(0).setStyles({\n          width: width - (this.getPaddingLeft() || 0) - (this.getPaddingRight() || 0),\n          height: height - (this.getPaddingTop() || 0) - (this.getPaddingBottom() || 0),\n          top: this.getPaddingTop() || 0,\n          left: this.getPaddingLeft() || 0\n        });\n      }\n    },\n\n\n\n\n    /*\n    ---------------------------------------------------------------------------\n      IMAGE API\n    ---------------------------------------------------------------------------\n    */\n\n    // property apply, overridden\n    _applyEnabled : function(value, old)\n    {\n      this.base(arguments, value, old);\n\n      if (this.getSource()) {\n        this._styleSource();\n      }\n    },\n\n\n    // property apply\n    _applySource : function(value, old)\n    {\n      // abort loading current image\n      if (old) {\n        if (qx.io.ImageLoader.isLoading(old)) {\n          qx.io.ImageLoader.abort(old);\n        }\n      }\n\n      this._styleSource();\n    },\n\n\n    // property apply\n    _applyScale : function(value) {\n      this._styleSource();\n    },\n\n\n    /**\n     * Remembers the mode to keep track which contentElement is currently in use.\n     * @param mode {String} internal mode (alphaScaled|scaled|nonScaled)\n     */\n    __setMode : function(mode) {\n      this.__mode = mode;\n    },\n\n\n    /**\n     * Returns the current mode if set. Otherwise checks the current source and\n     * the current scaling to determine the current mode.\n     *\n     * @return {String} current internal mode\n     */\n    __getMode : function()\n    {\n      if (this.__mode == null)\n      {\n        var source = this.getSource();\n\n        if (source && qx.lang.String.startsWith(source, \"@\")) {\n          this.__mode = \"font\";\n        }\n\n        var isPng = false;\n        if (source != null) {\n          isPng = source.endsWith(\".png\");\n        }\n\n        if (this.getScale() && isPng && qx.core.Environment.get(\"css.alphaimageloaderneeded\")) {\n          this.__mode = \"alphaScaled\";\n        } else if (this.getScale()) {\n          this.__mode = \"scaled\";\n        } else {\n          this.__mode = \"nonScaled\";\n        }\n      }\n\n      return this.__mode;\n    },\n\n\n    /**\n     * Creates a contentElement suitable for the current mode\n     *\n     * @param mode {String} internal mode\n     * @return {qx.html.Image} suitable image content element\n     */\n    __createSuitableContentElement : function(mode)\n    {\n      var scale;\n      var tagName;\n      var clazz = qx.html.Image;\n\n      if (mode == \"font\")\n      {\n        clazz = qx.html.Label;\n        scale = true;\n        tagName = \"div\";\n      }\n      else if (mode == \"alphaScaled\")\n      {\n        scale = true;\n        tagName = \"div\";\n      }\n      else if (mode == \"nonScaled\")\n      {\n        scale = false;\n        tagName = \"div\";\n      }\n      else\n      {\n        scale = true;\n        tagName = \"img\";\n      }\n\n      var element = new (clazz)(tagName);\n      element.connectWidget(this);\n      element.setStyles({\n        \"overflowX\": \"hidden\",\n        \"overflowY\": \"hidden\",\n        \"boxSizing\": \"border-box\"\n      });\n\n      if (mode == \"font\") {\n        element.setRich(true);\n      }\n      else {\n        element.setScale(scale);\n\n        if (qx.core.Environment.get(\"css.alphaimageloaderneeded\")) {\n          var wrapper = this.__wrapper = new qx.html.Element(\"div\");\n          element.connectWidget(this);\n          wrapper.setStyle(\"position\", \"absolute\");\n          wrapper.add(element);\n          return wrapper;\n        }\n      }\n\n      return element;\n    },\n\n\n    /**\n     * Returns a contentElement suitable for the current mode\n     *\n     * @return {qx.html.Image} suitable image contentElement\n     */\n    __getSuitableContentElement : function()\n    {\n      if (this.$$disposed) {\n        return null;\n      }\n\n      var mode = this.__getMode();\n\n      if (this.__contentElements[mode] == null) {\n        this.__contentElements[mode] = this.__createSuitableContentElement(mode);\n      }\n\n      var element = this.__contentElements[mode];\n\n      if (!this.__currentContentElement) {\n        this.__currentContentElement = element;\n      }\n\n      return element;\n    },\n\n\n    /**\n     * Applies the source to the clipped image instance or preload\n     * an image to detect sizes and apply it afterwards.\n     *\n     */\n    _styleSource : function()\n    {\n      var AliasManager = qx.util.AliasManager.getInstance();\n      var ResourceManager = qx.util.ResourceManager.getInstance();\n\n      var source = AliasManager.resolve(this.getSource());\n\n      var element = this.getContentElement();\n      if (this.__wrapper) {\n        element = element.getChild(0);\n      }\n\n      if (!source)\n      {\n        this.__resetSource(element);\n        return;\n      }\n\n      this.__checkForContentElementSwitch(source);\n\n      if ((qx.core.Environment.get(\"engine.name\") == \"mshtml\") &&\n        (parseInt(qx.core.Environment.get(\"engine.version\"), 10) < 9 ||\n         qx.core.Environment.get(\"browser.documentmode\") < 9))\n      {\n        var repeat = this.getScale() ? \"scale\" : \"no-repeat\";\n        element.tagNameHint = qx.bom.element.Decoration.getTagName(repeat, source);\n      }\n\n      var contentEl = this.__getContentElement();\n\n      // Detect if the image registry knows this image\n      if (ResourceManager.isFontUri(source)) {\n        this.__setManagedImage(contentEl, source);\n      }\n      else if (ResourceManager.has(source)) {\n        var highResolutionSource = this._findHighResolutionSource(source);\n        if (highResolutionSource) {\n          var imageWidth = ResourceManager.getImageHeight(source);\n          var imageHeight = ResourceManager.getImageWidth(source);\n          this.setWidth(imageWidth);\n          this.setHeight(imageHeight);\n\n          // set background size on current element (div or img)\n          var backgroundSize = imageWidth + \"px, \" + imageHeight + \"px\";\n          this.__currentContentElement.setStyle(\"background-size\", backgroundSize);\n\n          this.setSource(highResolutionSource);\n          source = highResolutionSource;\n        }\n        this.__setManagedImage(contentEl, source);\n        this.__fireLoadEvent();\n      } else if (qx.io.ImageLoader.isLoaded(source)) {\n        this.__setUnmanagedImage(contentEl, source);\n        this.__fireLoadEvent();\n      } else {\n        this.__loadUnmanagedImage(contentEl, source);\n      }\n    },\n\n\n    /**\n     * Helper function, which fires <code>loaded</code> event asynchronously.\n     * It emulates native <code>loaded</code> event of an image object. This\n     * helper will be called, if you try to load a managed image or an\n     * previously loaded unmanaged image.\n     */\n    __fireLoadEvent : function()\n    {\n      this.__requestId++;\n      qx.bom.AnimationFrame.request(function(rId){\n        // prevent firing of the event if source changed in the meantime\n        if (rId === this.__requestId) {\n          this.fireEvent(\"loaded\");\n        } else {\n          this.fireEvent(\"aborted\");\n        }\n      }.bind(this, this.__requestId));\n    },\n\n\n    /**\n     * Returns the content element.\n     * @return {qx.html.Image} content element\n     */\n    __getContentElement : function()\n    {\n      var contentEl = this.__currentContentElement;\n      if (this.__wrapper) {\n        contentEl = contentEl.getChild(0);\n      }\n\n      return contentEl;\n    },\n\n\n    /**\n     * Checks if the current content element is capable to display the image\n     * with the current settings (scaling, alpha PNG)\n     *\n     * @param source {String} source of the image\n     */\n    __checkForContentElementSwitch : qx.core.Environment.select(\"engine.name\",\n    {\n      \"mshtml\" : function(source)\n      {\n        var alphaImageLoader = qx.core.Environment.get(\"css.alphaimageloaderneeded\");\n        var isPng = source.endsWith(\".png\");\n        var isFont = source.startsWith(\"@\");\n\n        if (isFont) {\n          this.__setMode(\"font\");\n        } else if (alphaImageLoader && isPng)\n        {\n          if (this.getScale() && this.__getMode() != \"alphaScaled\") {\n            this.__setMode(\"alphaScaled\");\n          } else if (!this.getScale() && this.__getMode() != \"nonScaled\") {\n            this.__setMode(\"nonScaled\");\n          }\n        }\n        else\n        {\n          if (this.getScale() && this.__getMode() != \"scaled\") {\n            this.__setMode(\"scaled\");\n          } else if (!this.getScale() && this.__getMode() != \"nonScaled\") {\n            this.__setMode(\"nonScaled\");\n          }\n        }\n\n        this.__checkForContentElementReplacement(this.__getSuitableContentElement());\n      },\n\n      \"default\" : function(source)\n      {\n        var isFont = source && qx.lang.String.startsWith(source, \"@\");\n\n        if (isFont) {\n          this.__setMode(\"font\");\n        } else if (this.getScale() && this.__getMode() != \"scaled\") {\n          this.__setMode(\"scaled\");\n        } else if (!this.getScale() && this.__getMode() != \"nonScaled\") {\n          this.__setMode(\"nonScaled\");\n        }\n\n        this.__checkForContentElementReplacement(this.__getSuitableContentElement());\n      }\n    }),\n\n\n    /**\n     * Checks the current child and replaces it if necessary\n     *\n     * @param elementToAdd {qx.html.Image} content element to add\n     */\n    __checkForContentElementReplacement : function(elementToAdd)\n    {\n      var currentContentElement = this.__currentContentElement;\n\n      if (currentContentElement != elementToAdd)\n      {\n        if (currentContentElement != null)\n        {\n          var pixel = \"px\";\n          var styles = {};\n\n          //inherit styles from current element\n          var currentStyles = currentContentElement.getAllStyles();\n          if(currentStyles) {\n            for(var prop in currentStyles) {\n                styles[prop] = currentStyles[prop];\n            }\n          }\n\n          // Copy dimension and location of the current content element\n          var bounds = this.getBounds();\n          if (bounds != null)\n          {\n            styles.width = bounds.width + pixel;\n            styles.height = bounds.height + pixel;\n          }\n\n          var insets = this.getInsets();\n          styles.left = parseInt(currentContentElement.getStyle(\"left\") || insets.left) + pixel;\n          styles.top = parseInt(currentContentElement.getStyle(\"top\") || insets.top) + pixel;\n\n          styles.zIndex = 10;\n\n          var newEl = this.__wrapper ? elementToAdd.getChild(0) : elementToAdd;\n          newEl.setStyles(styles, true);\n          newEl.setSelectable(this.getSelectable());\n\n          if (!currentContentElement.isVisible()) {\n            elementToAdd.hide();\n          } else if (!elementToAdd.isVisible()) {\n            elementToAdd.show();\n          }\n\n          if (!currentContentElement.isIncluded()) {\n            elementToAdd.exclude();\n          } else if (!elementToAdd.isIncluded()) {\n            elementToAdd.include();\n          }\n\n          var container = currentContentElement.getParent();\n\n          if (container) {\n            var index = container.getChildren().indexOf(currentContentElement);\n            container.removeAt(index);\n            container.addAt(elementToAdd, index);\n          }\n          // force re-application of source so __setSource is called again\n          var hint = newEl.getNodeName();\n          if (newEl.setSource) {\n            newEl.setSource(null);\n          }\n          else {\n            newEl.setValue(\"\");\n          }\n          var currentEl = this.__getContentElement();\n          newEl.tagNameHint = hint;\n          newEl.setAttribute(\"class\", currentEl.getAttribute(\"class\"));\n\n          // Flush elements to make sure the DOM elements are created.\n          qx.html.Element.flush();\n          var currentDomEl = currentEl.getDomElement();\n          var newDomEl = elementToAdd.getDomElement();\n\n          // copy event listeners\n          var listeners = currentContentElement.getListeners() || [];\n          listeners.forEach(function(listenerData) {\n            elementToAdd.addListener(listenerData.type, listenerData.handler, listenerData.self, listenerData.capture);\n          });\n\n          if (currentDomEl && newDomEl) {\n            // Switch the DOM elements' hash codes. This is required for the event\n            // layer to work [BUG #7447]\n            var currentHash = currentDomEl.$$hash;\n            currentDomEl.$$hash = newDomEl.$$hash;\n            newDomEl.$$hash = currentHash;\n          }\n\n          this.__currentContentElement = elementToAdd;\n        }\n      }\n    },\n\n\n    /**\n     * Use the ResourceManager to set a managed image\n     *\n     * @param el {Element} image DOM element\n     * @param source {String} source path\n     */\n    __setManagedImage : function(el, source)\n    {\n      var ResourceManager = qx.util.ResourceManager.getInstance();\n      var isFont = ResourceManager.isFontUri(source);\n\n      // Try to find a disabled image in registry\n      if (!this.getEnabled())\n      {\n        var disabled = source.replace(/\\.([a-z]+)$/, \"-disabled.$1\");\n        if (!isFont && ResourceManager.has(disabled))\n        {\n          source = disabled;\n          this.addState(\"replacement\");\n        }\n        else\n        {\n          this.removeState(\"replacement\");\n        }\n      }\n\n      // Optimize case for enabled changes when no disabled image was found\n      if (!isFont && el.getSource() === source) {\n        return;\n      }\n\n      // Special case for non resource manager handled font icons\n      if (isFont) {\n        var size;\n\n        // Don't use scale if size is set via postfix\n        if (this.getScale() && parseInt(source.split(\"/\")[2], 10)) {\n          this.setScale(false);\n        }\n\n        // Adjust size if scaling is applied\n        if (this.getScale()) {\n          var width = this.getWidth() || this.getHeight() || 40;\n          var height = this.getHeight() || this.getWidth() || 40;\n          size = width > height ? height : width;\n        }\n        else {\n          var font = qx.theme.manager.Font.getInstance().resolve(source.match(/@([^/]+)/)[1]);\n          if (qx.core.Environment.get(\"qx.debug\")) {\n            this.assertObject(font, \"Virtual image source contains unkown font descriptor\");\n          }\n          size = parseInt(source.split(\"/\")[2] || font.getSize(), 10);\n        }\n\n        // Default to something definitively numeric if nothing set\n        if (!size) {\n          size = 0;\n        }\n\n        this.__updateContentHint(size, size);\n\n        // Apply source\n        this.__setSource(el, source);\n      }\n      else {\n        // Apply source\n        this.__setSource(el, source);\n\n        // Compare with old sizes and relayout if necessary\n        this.__updateContentHint(\n          ResourceManager.getImageWidth(source),\n          ResourceManager.getImageHeight(source)\n        );\n      }\n    },\n\n    _applyDimension : function()\n    {\n      this.base(arguments);\n      \n      var isFont = this.getSource() && qx.lang.String.startsWith(this.getSource(), \"@\");\n      if (isFont) {\n        var el = this.getContentElement();\n        if (el) {\n          if (this.getScale()) {\n            var width = this.getWidth() || this.getHeight() || 40;\n            var height = this.getHeight() || this.getWidth() || 40;\n            el.setStyle(\"fontSize\", (width > height ? height : width) + \"px\");\n          }\n          else {\n            var font = qx.theme.manager.Font.getInstance().resolve(this.getSource().match(/@([^/]+)/)[1]);\n            el.setStyle(\"fontSize\", font.getSize() + \"px\");\n          }\n        }\n      }\n    },\n\n    /**\n     * Use the infos of the ImageLoader to set an unmanaged image\n     *\n     * @param el {Element} image DOM element\n     * @param source {String} source path\n     */\n    __setUnmanagedImage : function(el, source)\n    {\n      var ImageLoader = qx.io.ImageLoader;\n\n      // Apply source\n      this.__setSource(el, source);\n\n      // Compare with old sizes and relayout if necessary\n      var width = ImageLoader.getWidth(source);\n      var height = ImageLoader.getHeight(source);\n      this.__updateContentHint(width, height);\n    },\n\n\n    /**\n     * Use the ImageLoader to load an unmanaged image\n     *\n     * @param el {Element} image DOM element\n     * @param source {String} source path\n     */\n    __loadUnmanagedImage : function(el, source)\n    {\n      var ImageLoader = qx.io.ImageLoader;\n\n      if (qx.core.Environment.get(\"qx.debug\"))\n      {\n        // loading external images via HTTP/HTTPS is a common usecase, as is\n        // using data URLs.\n        var sourceLC = source.toLowerCase();\n        if (!sourceLC.startsWith(\"http\") &&\n            !sourceLC.startsWith(\"data:image/\"))\n        {\n          var self = this.self(arguments);\n\n          if (!self.__warned) {\n            self.__warned = {};\n          }\n\n          if (!self.__warned[source])\n          {\n            this.debug(\"try to load an unmanaged relative image: \" + source);\n            self.__warned[source] = true;\n          }\n        }\n      }\n\n      // only try to load the image if it not already failed\n      if(!ImageLoader.isFailed(source)) {\n        ImageLoader.load(source, this.__loaderCallback, this);\n      } else {\n        this.__resetSource(el);\n      }\n    },\n\n    /**\n     * Reset source displayed by the DOM element.\n     *\n     * @param el {Element} image DOM element\n     */\n    __resetSource : function(el)\n    {\n      if (el != null) {\n        if (el instanceof qx.html.Image) {\n          el.resetSource();\n        }\n        else {\n          el.resetValue();\n        }\n      }\n    },\n\n    /**\n     * Combines the decorator's image styles with our own image to make sure\n     * gradient and backgroundImage decorators work on Images.\n     *\n     * @param el {Element} image DOM element\n     * @param source {String} source path\n     */\n    __setSource: function (el, source) {\n      var isFont = source && qx.lang.String.startsWith(source, \"@\");\n\n      if (isFont) {\n        var sparts = source.split(\"/\");\n        var fontSource = source;\n        if (sparts.length > 2) {\n          fontSource = sparts[0] + \"/\" + sparts[1];\n        }\n\n\n        var ResourceManager = qx.util.ResourceManager.getInstance();\n        var font = qx.theme.manager.Font.getInstance().resolve(source.match(/@([^/]+)/)[1]);\n        var fontStyles = qx.lang.Object.clone(font.getStyles());\n        delete fontStyles.color;\n        el.setStyles(fontStyles);\n        el.setStyle(\"font\");\n        el.setStyle(\"display\", \"table-cell\");\n        el.setStyle(\"verticalAlign\", \"middle\");\n        el.setStyle(\"textAlign\", \"center\");\n\n        if (this.getScale()) {\n          el.setStyle(\"fontSize\", (this.__width > this.__height ? this.__height : this.__width) + \"px\");\n        }\n        else {\n          var size = parseInt(sparts[2] || qx.theme.manager.Font.getInstance().resolve(source.match(/@([^/]+)/)[1]).getSize());\n          el.setStyle(\"fontSize\", size + \"px\");\n        }\n\n        var resource = ResourceManager.getData(fontSource);\n        if (resource) {\n          el.setValue(String.fromCharCode(resource[2]));\n        }\n        else {\n          var charCode = parseInt(qx.theme.manager.Font.getInstance().resolve(source.match(/@([^/]+)\\/(.*)$/)[2]), 16);\n          if (qx.core.Environment.get(\"qx.debug\")) {\n            this.assertNumber(charCode, \"Font source needs either a glyph name or the unicode number in hex\");\n          }\n          el.setValue(String.fromCharCode(charCode));\n        }\n\n        return;\n      }\n      else if (el.getNodeName() == \"div\") {\n\n        // checks if a decorator already set.\n        // In this case we have to merge background styles\n        var decorator = qx.theme.manager.Decoration.getInstance().resolve(this.getDecorator());\n        if (decorator) {\n          var hasGradient = (decorator.getStartColor() && decorator.getEndColor());\n          var hasBackground = decorator.getBackgroundImage();\n          if (hasGradient || hasBackground) {\n            var repeat = this.getScale() ? \"scale\" : \"no-repeat\";\n\n            // get the style attributes for the given source\n            var attr = qx.bom.element.Decoration.getAttributes(source, repeat);\n            // get the background image(s) defined by the decorator\n            var decoratorStyle = decorator.getStyles(true);\n\n            var combinedStyles = {\n              \"backgroundImage\": attr.style.backgroundImage,\n              \"backgroundPosition\": (attr.style.backgroundPosition || \"0 0\"),\n              \"backgroundRepeat\": (attr.style.backgroundRepeat || \"no-repeat\")\n            };\n\n            if (hasBackground) {\n              combinedStyles[\"backgroundPosition\"] += \",\" + decoratorStyle[\"background-position\"] || \"0 0\";\n              combinedStyles[\"backgroundRepeat\"] += \", \" + decorator.getBackgroundRepeat();\n            }\n\n            if (hasGradient) {\n              combinedStyles[\"backgroundPosition\"] += \", 0 0\";\n              combinedStyles[\"backgroundRepeat\"] += \", no-repeat\";\n            }\n\n            combinedStyles[\"backgroundImage\"] += \",\" + (decoratorStyle[\"background-image\"] || decoratorStyle[\"background\"]);\n\n            // apply combined background images\n            el.setStyles(combinedStyles);\n\n            return;\n          }\n        } else {\n          // force re-apply to remove old decorator styles\n          el.setSource(null);\n        }\n      }\n\n      el.setSource(source);\n    },\n\n    /**\n     * Detects whether there is a high-resolution image available.\n     * A high-resolution image is assumed to have the same file name as\n     * the parameter source, but with a pixelRatio identifier before the file\n     * extension, like \"@2x\".\n     * Medium Resolution: \"example.png\", high-resolution: \"example@2x.png\"\n     *\n     * @param lowResImgSrc {String} source of the low resolution image.\n     * @return {String|Boolean} If a high-resolution image source.\n     */\n    _findHighResolutionSource: function(lowResImgSrc) {\n      var pixelRatioCandidates = [\"3\", \"2\", \"1.5\"];\n\n      // Calculate the optimal ratio, based on the rem scale factor of the application and the device pixel ratio.\n      var factor = parseFloat(qx.bom.client.Device.getDevicePixelRatio().toFixed(2));\n      if (factor <= 1) {\n        return false;\n      }\n\n      var i = pixelRatioCandidates.length;\n      while (i > 0 && factor > pixelRatioCandidates[--i]) {}\n\n      var hiResImgSrc;\n      var k;\n\n      // Search for best img with a higher resolution.\n      for (k = i; k >= 0; k--) {\n        hiResImgSrc = this._getHighResolutionSource(lowResImgSrc, pixelRatioCandidates[k]);\n        if (hiResImgSrc) {\n          return hiResImgSrc;\n        }\n      }\n\n      // Search for best img with a lower resolution.\n      for (k = i + 1; k < pixelRatioCandidates.length; k++) {\n        hiResImgSrc = this._getHighResolutionSource(lowResImgSrc, pixelRatioCandidates[k]);\n        if (hiResImgSrc) {\n          return hiResImgSrc;\n        }\n      }\n\n      return null;\n    },\n\n    /**\n     * Returns the source name for the high-resolution image based on the passed\n     * parameters.\n     * @param source {String} the source of the medium resolution image.\n     * @param pixelRatio {Number} the pixel ratio of the high-resolution image.\n     * @return {String} the high-resolution source name or null if no source could be found.\n     */\n    _getHighResolutionSource : function(source, pixelRatio) {\n      var fileExtIndex = source.lastIndexOf('.');\n      if (fileExtIndex > -1) {\n        var pixelRatioIdentifier = \"@\" + pixelRatio + \"x\";\n        var candidate = source.slice(0, fileExtIndex) + pixelRatioIdentifier + source.slice(fileExtIndex);\n\n        if(qx.util.ResourceManager.getInstance().has(candidate)) {\n          return candidate;\n        }\n      }\n      return null;\n    },\n\n    /**\n     * Event handler fired after the preloader has finished loading the icon\n     *\n     * @param source {String} Image source which was loaded\n     * @param imageInfo {Map} Dimensions of the loaded image\n     */\n    __loaderCallback : function(source, imageInfo)\n    {\n      // Ignore the callback on already disposed images\n      if (this.$$disposed === true) {\n        return;\n      }\n\n      // Ignore when the source has already been modified\n      if (source !== qx.util.AliasManager.getInstance().resolve(this.getSource())) {\n        this.fireEvent(\"aborted\");\n        return;\n      }\n\n      /// Output a warning if the image could not loaded and quit\n      if (imageInfo.failed) {\n        this.warn(\"Image could not be loaded: \" + source);\n        this.fireEvent(\"loadingFailed\");\n      } else if (imageInfo.aborted) {\n        this.fireEvent(\"aborted\");\n        return;\n      } else {\n        this.fireEvent(\"loaded\");\n      }\n\n      // Update image\n      this.__setUnmanagedImage(this.__getContentElement(), source);\n    },\n\n\n    /**\n     * Updates the content hint when the image size has been changed\n     *\n     * @param width {Integer} width of the image\n     * @param height {Integer} height of the image\n     */\n    __updateContentHint : function(width, height)\n    {\n      // Compare with old sizes and relayout if necessary\n      if (width !== this.__width || height !== this.__height)\n      {\n        this.__width = width;\n        this.__height = height;\n\n        qx.ui.core.queue.Layout.add(this);\n      }\n    }\n  },\n\n\n  /*\n  *****************************************************************************\n     DESTRUCTOR\n  *****************************************************************************\n  */\n\n  destruct : function() {\n    for (var mode in this.__contentElements) {\n      if (this.__contentElements.hasOwnProperty(mode)) {\n        this.__contentElements[mode].disconnectWidget(this);\n      }\n    }\n\n    delete this.__currentContentElement;\n    if (this.__wrapper) {\n      delete this.__wrapper;\n    }\n\n    this._disposeMap(\"__contentElements\");\n  }\n});\n"
  ]
}